---
version: "3.7"

services:
  rabbitmq:
    container_name: rabbitmq_integration
    image: rabbitmq:3-management
    ports:
      - 5672:5672
      - 15672:15672
  metrics:
    container_name: machcoll_metrics_integration
    image: nats-metrics-img:master-9a39559
    depends_on:
      - rabbitmq
    ports:
      - 5322:5322
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
  machcoll:
    container_name: machcoll_integration
    image: machcoll-img:dev-1bea126
    depends_on:
      - metrics
    ports:
      - 5321:5321
    environment:
      - PYTHONUNBUFFERED=1
      - MC_SCENARIO_FILENAME
      - MC_AIRSPACE_FILENAME
    restart: unless-stopped
  # NOTE(rkm 2020-01-31) For debugging, you can uncomment this section and use this as a
  # standard docker-compose file
  # bluebird:
  #   container_name: bluebird_integration
  #   build:
  #     args:
  #       - NATS_PYPI_INDEX=$NATS_PYPI_INDEX
  #     context: ../../../
  #   depends_on:
  #     - machcoll
  #   volumes:
  #     - /usr/src/app/logs/ # Prevents any local logs being copied to the container
  #   ports:
  #     - 5001:5001
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #     - MQ_URL="amqp://guest:guest@localhost:5672/%2F"
  #   command: sh -c "./wait-for-it.sh --timeout=0 machcoll:5321 && python ./run.py --sim-type=machcoll"
  #   restart: unless-stopped
